# 队伍管理与战斗系统 - 完整提案

**提案 ID**: `20251022-team-management-and-battle`
**状态**: Proposed
**创建日期**: 2025-10-22
**预计工作量**: 27.5 小时（3-4 天）

## 快速导航

1. **问题定义** → 查看 `proposal.md`
2. **架构设计** → 查看 `design.md`
3. **功能规范** → 查看 `specs/` 目录下的 spec.md 文件
4. **实现计划** → 查看 `tasks.md`

## 提案概览

本提案包含三个紧密关联的功能模块：

### 1️⃣ 队伍详细信息系统 (Team Detail System)

**目标**: 让玩家在查看队伍时看到宝可梦的完整信息

**包含内容**:
- 显示属性 (HP, 攻击, 防守, 特攻, 特防, 速度)
- 显示招式 (名称, 类型, 威力, 命中率, PP)
- 显示捕捉信息 (捕捉球, 地点, 日期)
- 显示经验值和升级进度

**实现工作**: 3 个任务，3.5 小时

---

### 2️⃣ 宠物仓库系统 (Storage System)

**目标**: 实现无限制的宝可梦存储和管理系统

**包含内容**:
- 20 个存储箱，每个 30 个位置
- 放生机制（永久删除宝可梦）
- 查询和搜索功能
- 宝可梦快速交换（队伍 ↔ 仓库）
- 箱子管理（重命名等）

**实现工作**: 4 个任务，5.5 小时

---

### 3️⃣ 战斗系统完整化 (Battle System)

**目标**: 实现完整、可玩的回合制战斗系统

**包含内容**:
- 完整回合制流程
- 招式系统 (PP 消耗, 伤害计算, 属性克制)
- 道具使用 (HP 恢复, 状态治疗等)
- 宝可梦切换
- 逃跑系统 (60% 成功率)
- 战斗日志记录
- 结果结算 (经验值, 金钱, 升级)

**实现工作**: 10 个任务，16 小时

---

## 核心设计决策

### 数据结构扩展

```rust
// Pokemon 结构增加捕捉信息追踪
pub struct Pokemon {
    // 既有字段...
    pub caught_with: String,         // 捕捉球类型
    pub caught_location_id: u32,     // 捕捉地点
    pub caught_date: u64,            // 捕捉时间
}

// Player 结构增加仓库
pub struct Player {
    // 既有字段...
    pub storage_system: StorageSystem, // 新增仓库
}

// 仓库系统：20 个箱子，每个 30 只宝可梦
pub struct StorageSystem {
    pub boxes: Vec<PokemonBox>,
}
```

### 战斗系统架构

```
战斗流程:
  初始化 → 回合循环 → 行动处理 → 状态更新 → 结束判定

行动选项:
  ├─ 使用招式 (计算伤害, 更新 PP/HP)
  ├─ 使用道具 (恢复 HP 等)
  ├─ 切换宝可梦 (验证队伍状态)
  └─ 逃跑 (60% 成功率)

战斗结算:
  ├─ 胜利: 经验值 + 金钱 + 升级
  ├─ 失败: 宝可梦昏迷
  └─ 逃脱: 返回原位置
```

---

## 相关文件结构

```
openspec/changes/20251022-team-management-and-battle/
├── proposal.md                                 # 提案概述
├── design.md                                   # 详细设计
├── tasks.md                                    # 实现任务
├── README.md                                   # 本文件
└── specs/
    ├── team-detail-system/
    │   └── spec.md                            # 队伍详细信息规范
    ├── storage-system/
    │   └── spec.md                            # 宠物仓库规范
    └── battle-system/
        └── spec.md                            # 战斗系统规范
```

---

## 实现阶段

### Phase 1: 队伍详细信息系统 (1 天)
- 扩展 Pokemon 数据结构
- 创建队伍详细菜单
- 集成到游戏界面

### Phase 2: 宠物仓库系统 (1.5 天)
- 创建存储系统数据结构
- 实现仓库管理菜单
- 实现队伍-仓库交换

### Phase 3: 战斗系统完整化 (2 天)
- 扩展 Battle 结构
- 实现伤害计算和招式系统
- 实现道具、切换、逃跑
- 实现战斗菜单和流程

### Phase 4: 测试和集成 (0.5 天)
- 单元测试和集成测试
- 编译和发布验证

---

## 验收标准

### 功能完整性
- ✅ 队伍详细信息完整显示
- ✅ 宠物仓库可以存储和管理宝可梦
- ✅ 战斗系统支持完整的回合制流程
- ✅ 所有菜单可用且用户友好

### 代码质量
- ✅ 代码编译无错误
- ✅ 测试覆盖率 > 80%
- ✅ 所有单元测试通过
- ✅ 集成测试通过

### 用户体验
- ✅ 菜单导航直观
- ✅ 信息显示清晰
- ✅ 操作反馈及时
- ✅ 不会意外丢失数据

---

## 开始实现

要开始实现此提案，请运行：

```bash
openspec apply 20251022-team-management-and-battle
```

这将自动：
1. 创建必要的目录结构
2. 加载所有规范
3. 初始化任务跟踪

---

## 更新日志

| 日期 | 更新 |
|------|------|
| 2025-10-22 | 创建初始提案 |

---

## 相关规范

- `20251021-location-binding-system` - 位置系统（与战斗集成）
- `20251021-pokemon-revival-system` - 复活系统（与战斗集成）
- `20251021-pokemon-core` - 宝可梦基础数据

---

**准备就绪** ✅

所有文档已完成，规范已验证。可以开始实现！

使用 `openspec apply 20251022-team-management-and-battle` 开始。
