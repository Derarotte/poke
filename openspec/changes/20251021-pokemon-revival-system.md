# 宝可梦复活系统 - 开放式游戏设计

## 状态
- 创建时间: 2025-10-21
- 状态: 提案阶段

## 目标

实现一个**开放式游戏系统**，使玩家的宝可梦昏迷后不会导致游戏结束，而是通过以下方式进行复活：
1. **使用恢复道具** - 消耗复活药或恢复药
2. **支付金币** - 在精灵中心付费复活
3. **多队伍切换** - 通过切换其他宝可梦继续游戏

这样可以让游戏变成一个持久且有策略性的冒险，而不是单局游戏。

## 设计

### 系统架构

```
宝可梦复活系统
├── 复活方式1: 使用道具
│   ├── 恢复药 (Potion) - 恢复50% HP
│   ├── 超级恢复药 (Super Potion) - 恢复100% HP
│   └── 全复活 (Revive) - 复活并恢复50% HP
├── 复活方式2: 支付金币
│   ├── 精灵中心 (Pokemon Center)
│   ├── 基础复活费: 200 金币
│   └── VIP 复活费: 100 金币 (需要升级)
└── 复活方式3: 队伍管理
    ├── 切换未昏迷的宝可梦
    └── 继续冒险不影响进度
```

### 数据结构扩展

#### Player 结构增强
```rust
struct Player {
    // ... 现有字段 ...
    money: u32,                    // 已有，现在更重要
    visited_pokemon_center: bool,  // 新增：是否拜访过精灵中心

    // 新增方法：
    pub fn revive_pokemon(&mut self, pokemon_index: usize) -> Result<(), String>
    pub fn pay_for_revival(&mut self, cost: u32) -> bool
}
```

#### 新增道具类型
```rust
enum ItemType {
    Potion,           // 基础恢复药 (50% HP)
    SuperPotion,      // 超级恢复药 (100% HP)
    Revive,           // 全复活药 (复活 + 50% HP)
    FullRestore,      // 完全恢复 (复活 + 100% HP)
    Antidote,         // 解毒药 (未来用)
    PokeBall,         // 已有
}
```

### 游戏流程修改

**现在的流程**:
```
战斗失败 → 检查是否有活着的宝可梦
         → 否 → 游戏结束
```

**新的流程**:
```
战斗失败 → 检查是否有活着的宝可梦
         → 否 → 进入恢复选择菜单
            ├─ 使用道具复活
            ├─ 去精灵中心付费复活
            └─ 回到主菜单（全队失败时）
         → 是 → 继续游戏
```

### 精灵中心系统

```
进入精灵中心
├─ 显示当前队伍状态
├─ 显示复活费用
├─ 选择要复活的宝可梦
├─ 支付金币后复活
└─ 返回主菜单或继续探索
```

## 实现步骤

### 第一阶段：数据结构和道具系统
- [ ] 扩展 `Player` 结构体，添加金币管理
- [ ] 定义新的 `ItemType` 枚举
- [ ] 实现 `Item` 结构体 (名称、类型、数量、效果)
- [ ] 更新玩家初始背包 (增加一些恢复道具)
- [ ] 实现 `use_item()` 方法用于消耗道具

### 第二阶段：复活机制
- [ ] 实现 `Pokemon::revive()` 方法 (复活并恢复HP)
- [ ] 实现 `Player::revive_pokemon_with_item()` (使用道具复活)
- [ ] 实现 `Player::revive_pokemon_at_center()` (付费复活)
- [ ] 创建复活选择菜单

### 第三阶段：精灵中心
- [ ] 实现精灵中心菜单
- [ ] 显示队伍状态和复活费用
- [ ] 处理付费逻辑
- [ ] 更新玩家金币

### 第四阶段：游戏循环修改
- [ ] 修改游戏失败逻辑
- [ ] 移除硬性的"游戏结束"条件
- [ ] 添加恢复选择菜单
- [ ] 处理无法复活的情况 (金币和道具都不足)

### 第五阶段：战斗系统集成
- [ ] 战斗后自动进入恢复菜单
- [ ] 在菜单中显示昏迷宝可梦
- [ ] 支持多个宝可梦的复活

### 第六阶段：测试和调整
- [ ] 单元测试：复活机制
- [ ] 单元测试：金币计算
- [ ] 集成测试：完整的复活流程
- [ ] 平衡测试：复活费用和道具获取

## 关键特性

### 1. 多种复活方式

| 方式 | 成本 | 效果 | 何时用 |
|------|------|------|--------|
| 恢复药 | 1个道具 | 恢复50% HP | 临时补救 |
| 超级恢复药 | 1个道具 | 恢复100% HP | 重要战斗前 |
| 全复活 | 1个道具 | 复活+50% HP | 紧急情况 |
| 精灵中心 | 200-100金币 | 复活全队+回满HP | 推荐方式 |

### 2. 经济系统

**金币来源**:
- 战胜宝可梦: 50 金币
- 挑战馆主: 500+ 金币
- 完成任务: 100-200 金币

**金币花费**:
- 精灵中心复活: 200 金币/只宝可梦
- 购买道具: 150 金币/瓶恢复药
- VIP 会员: 500 金币/月 (10% 复活折扣)

### 3. 灵活的队伍管理

- 可以有活跃队伍和后备队伍
- 宝可梦昏迷但不消失
- 可以随时进行队伍调整
- 没有"游戏结束"的强制结束

## CLI 菜单示例

### 复活选择菜单
```
╔═════════════════════════════════════╗
║    你的队伍全部昏迷了!             ║
║    选择复活方式:                    ║
╠═════════════════════════════════════╣
║ 1. 使用道具 (恢复药 x3)            ║
║ 2. 去精灵中心 (200 金币)            ║
║ 3. 回到主菜单                       ║
║ 4. 查看队伍状态                     ║
╚═════════════════════════════════════╝
请选择:
```

### 道具使用菜单
```
╔═════════════════════════════════════╗
║       选择恢复道具                  ║
╠═════════════════════════════════════╣
║ 1. 恢复药 (50% HP) x3               ║
║ 2. 超级恢复药 (100% HP) x1          ║
║ 3. 全复活 (复活+50% HP) x2          ║
║ 0. 返回                             ║
╚═════════════════════════════════════╝
请选择:
```

### 精灵中心菜单
```
╔═════════════════════════════════════╗
║      欢迎来到精灵中心!             ║
║      你的金币: 500                  ║
╠═════════════════════════════════════╣
║ 昏迷宝可梦:                         ║
║ 1. 皮卡丘 (200 金币) [选择复活]    ║
║ 2. 小火龙 (200 金币)               ║
║ 3. 杰尼龟 (200 金币)               ║
║ 0. 离开                             ║
╚═════════════════════════════════════╝
请选择:
```

## 向后兼容性

- 现有的宝可梦数据结构保持不变
- 现有的战斗系统保持不变
- 只是修改游戏失败后的处理流程
- 现有存档可能需要迁移 (增加金币初始值)

## 优势

### 玩家体验
- ✅ 游戏不会因一次失败而结束
- ✅ 提供多种恢复策略
- ✅ 增加游戏的持久性和可玩性
- ✅ 鼓励战术决策 (何时复活、何时逃跑)

### 游戏深度
- ✅ 经济管理变得重要
- ✅ 资源平衡 (金币 vs 道具)
- ✅ 队伍管理更复杂
- ✅ 增加重玩价值

## 测试计划

### 单元测试
- [ ] 复活机制正常工作
- [ ] 金币计算正确
- [ ] 道具消耗正确
- [ ] HP 恢复比例正确

### 集成测试
- [ ] 完整的复活流程
- [ ] 金币和道具的交互
- [ ] 队伍切换和复活的交互
- [ ] 无法复活的情况处理

### 平衡测试
- [ ] 复活费用是否合理
- [ ] 道具掉率是否平衡
- [ ] 游戏难度是否合适
- [ ] 经济循环是否健康

## 检查清单

- [ ] 代码完成
- [ ] 所有测试通过
- [ ] 菜单 UI 完成
- [ ] 文档更新
- [ ] 游戏平衡测试
- [ ] 用户测试反馈

## 交付物

- 复活系统的完整实现
- 精灵中心 NPC 和界面
- 更新的经济系统
- 测试套件
- 使用文档更新

## 相关功能 (未来扩展)

- 馆主对战系统
- 宝可梦进化系统
- 道具商店
- 任务系统
- 成就系统
